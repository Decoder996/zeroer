# fodors_zagats_test 差异总结与修复方案

## 发现的差异

### 1. ❌ 候选对数量差异很大（关键问题）

- **原始**: 2,915 个候选对
- **测试**: 10,734 个候选对
- **差异**: 测试数据多了 **268%**

**原因**: 字符串格式不同导致 blocking 的 tokenization 结果不同

### 2. ⚠️ 特征数量差异

- **原始**: 73 个特征
- **测试**: 69 个特征
- **缺失**: 4 个特征（都是 addr 相关的）

**原因**: addr 字段格式问题，导致某些特征无法提取

### 3. ⚠️ 正样本数量差异

- **原始**: 112 个正样本
- **测试**: 109 个正样本
- **差异**: 3 个

**原因**: Matches 文件差异（112 vs 110 行）+ blocking 过滤

### 4. ⚠️ F1 分数差异

- **原始**: F1 = 0.99
- **测试**: F1 = 0.96
- **差异**: 0.03

**原因**: 候选对太多（噪声）+ 特征缺失 + 正样本缺失

## 根本原因

**字符串格式问题**：
- 原始：`'arnie morton\'s'`（单引号，正确转义）
- 测试：`` ` arnie morton \ 's ' ``（反引号，转义格式不同，前后有空格）

这导致：
1. Blocking 产生更多候选对（tokenization 不同）
2. 某些特征无法提取（addr 相关特征）
3. 可能影响 matches 的匹配

## 修复方案

### 使用修复脚本

```bash
# 运行修复脚本
python fix_fodors_zagats_test_simple.py

# 删除旧的特征文件
rm datasets/fodors_zagats_test/candset_features_df.csv

# 重新运行
python zeroer.py fodors_zagats_test
```

### 预期修复效果

修复后应该：
- ✅ 候选对数量：~2,915（而不是 10,734）
- ✅ 特征数量：~73（而不是 69）
- ✅ 正样本数量：~112（而不是 109）
- ✅ F1 分数：~0.99（而不是 0.96）

## 修复脚本说明

`fix_fodors_zagats_test_simple.py` 会：
1. 备份原始文件（.backup）
2. 清理字符串格式：
   - 移除反引号
   - 修复转义格式
   - 清理多余空格
   - 统一为单引号格式
3. 保存修复后的文件

## 验证

修复后运行：
```bash
python zeroer.py fodors_zagats_test
```

如果修复成功，应该看到：
- 候选对数量接近 2,915
- F1 分数接近 0.99

